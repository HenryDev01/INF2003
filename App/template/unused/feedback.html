{% extends 'baseAdmin.html' %}
{% block links %}
<meta name="csrf-token" content="{{ csrf_token() }}">
  <link href="../static/vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">
 <link href="../static/css/style.css" rel="stylesheet">
{% endblock %}
{% block pageContent %}
<div id="updateModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
          <h4 class="modal-title">Update Product</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>

      </div>
      <div class="modal-body">
          <form id = "updateForm"  action="/updateQuestion" method = 'POST' enctype="multipart/form-data">
{{ form.csrf_token }}

 <div class  ="group">
                <input type="hidden" id='qid' class="form-control"  name = "q" required="" >
                <span class="form-highlight"></span>
                <span class="form-bar"></span>
            <span id="error_productID" class="text-danger"></span>
            </div>
               <div class  ="group">
                   <input type="hidden"  class="form-control"  >
                <label for="updateQNS" style="font-size:12px;" class="float-label" >&nbsp;Question</label>

                   <textarea id="updateQNS"  disabled  class="form-control"></textarea>
                <span class="form- highlight"></span>
                <span class="form-bar"></span>
            <span id="error_updateQNS" class="text-danger"></span>
            </div>

              <div class  ="group">
                                  <label for="updateName" style="font-size:12px;" class="float-label" >&nbsp;Answer</label>
                <input type="text" id="updateAnswer" class="form-control"  name = "updateAnswer">
                <span class="form-highlight"></span>
                <span class="form-bar"></span>
            <span id="error_updateName" class="text-danger"></span>
            </div>

            <div class = "group">

                <label for="url" style = 'font-size:12px;'  >Display at FAQ page:</label><br>
                <input type="radio" id="yes"  value="Yes" name = "display" required=""> Yes
                <input type="radio" id="no"  value="No" name = "display" required=""> No
			    <span id="error_updateUrl" class="text-danger"></span>
            </div>

            <input type  ="submit" id = "update" class = "btn btn-primary" value  = "Answer" onclick="return confirm('Are you sure you want to update this field?')">
          </form>
      </div>

      <div class="modal-footer">

      </div>
    </div>


  </div>
</div>

<div class="container-fluid">

          <!-- Page Heading -->
          <h1 class="h3 mb-2 text-gray-800">Feedback</h1>

          <!-- DataTales Example -->
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">User Feedbacks</h6>
            </div>
            <div class="card-body">
              <div class="table-responsive" style = "">
               <table class = "table table-bordered" id = "productDataTable" cellspacing="0" style  ="width:100%;">

                    <tr>
                    <thead>
                        <th>Question ID </th>
                        <th>Username</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Subject</th>
                        <th>Question/Feedback</th>
                         <th>Answer</th>
                        <th>Display</th>
                        <th>Actions</th>
                    </thead>
                        </tr>

                    <thead>
                    <tr>
                        <th>Question ID </th>
                        <th>Username</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Subject</th>
                        <th>Question/Feedback</th>
                        <th>Answer</th>
                        <th>Display</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                </table>
              </div>
            </div>
          </div>

        </div>

{% endblock %}
{% block script %}
<!-- Bootstrap core JavaScript-->
  <script src="../static/vendor/jquery/jquery.min.js"></script>
  <script src="../static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Core plugin JavaScript-->
  <script src="../static/vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Custom scripts for all pages-->
  <script src="../static/js/sb-admin-2.min.js"></script>

  <!-- Page level plugins -->
  <script src="../static/vendor/datatables/jquery.dataTables.min.js"></script>
  <script src="../static/vendor/datatables/dataTables.bootstrap4.min.js"></script>
    <script src = "../static/form.js"></script>
  <!-- Page level custom scripts -->

<script>



       function load(){
        $('#productDataTable').DataTable({
            'processing':true,
            'serverSide':false,
            'ajax':{url:"/retrieveFeedBack"},
            'columns':[
                {data:"questionID"},
                {data:"username"},
                {data:"name"},
                {data:"useremail"},
                {data:"usersubject"},
                {data:"userquestion"},
                {data:"answer"},
                {data:"display"},
                {data:"Actions"}

            ]
        });
        }
        $(document).ready(function(){

        $('#updateForm').submit(function(){
                alert('Successfully Updated!');
        })

 var csrftoken = $('meta[name=csrf-token]').attr('content');

            $.ajaxSetup({
                beforeSend: function(xhr, settings) {
                    if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken)
                    }
                }
            })
            load();


                $(document).on('click','#deleteBtn',function(){
                 var id = $(this).closest('tr').children('td:first').text();
                 var cfm = confirm("Are you sure you want to delete this record?");
                 if(cfm)
                 {
                    var reason = prompt('Please state your reason for deleting')
                    if(reason)
                    {
                      $.ajax({
                            data:{id:id},
                            dataType:'json',
                            type:'POST',
                            url:'/deleteQuestion',
                            success:function(data){
                               alert("Succesfully deleted!")
                              var table = $('#productDataTable').DataTable();
                             table.clear().destroy();
                              load();
                            },
                            error:function(error){

                                alert(error);
                            },
                            done:function(){

                            }
                            });
                 }else
                 {
                    alert('Please key in your reason!');
                 }

}



        });


        $(document).on('click','#updateBtn',function(){


            var id = $(this).closest('tr').children('td:first').text();
                         var qns = $(this).closest('tr').children('td:nth-child(6)').text();
             var answer = $(this).closest('tr').children('td:nth-child(7)').text();
            var display =  $(this).closest('tr').children('td:nth-child(8)').text();

            $('#qid').val(id);
            $('#updateQNS').val(qns);
           var qid=  $('#questionID').val(id);
            var answerField = $('#updateAnswer').val(answer);


            if(display == 'Yes')
                var option = $('#yes').prop('checked',true);
             else
                option = $('#no').prop('checked',true);




            });




        });



</script>
{% endblock %}
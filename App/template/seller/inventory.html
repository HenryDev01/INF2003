{% extends 'seller_base.html' %}
{% block links %}
<meta name="csrf-token" content="{{ csrf_token() }}">
  <link href="../static/vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">
 <link href="../static/css/style.css" rel="stylesheet">
{% endblock %}
{% block pageContent %}

<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
          <h4 class="modal-title">Add New Product</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>

      </div>
      <div class="modal-body">
        <form id = "addForm"  method = 'POST' action = '/addProduct'  enctype="multipart/form-data">

<!--              <div class  ="group">-->
<!--                <input type="text" id="name" class="form-control"  name = "name" required="">-->
<!--                <span class="form-highlight"></span>-->
<!--                <span class="form-bar"></span>-->
<!--                <label for="name" class="float-label" ><i class = "fa fa-user" style  = "padding-left:2px;"></i>Product Name</label>-->
<!--            <span id="error_name" class="text-danger"></span>-->
<!--            </div>-->

               <div class  ="group">
                                    <label style="font-size:12px" for = 'role' class = "float-label" name = 'role'>Product Category</label>

                  <span class = 'form-highlight'></span>
                <span class = 'form-bar'></span>
                  <select class="form-control" id="category" name = 'name'>
                        <option value = "Keyboard">Keyboard</option>
                        <option value = "Graphic Cards">Graphic Cards</option>
                        <option value = "Mouse">Mouse</option>
                          <option value = "CPU">CPU</option>
                          <option value = "RAM">RAM</option>
                          <option value = "Audio Accessories">Audio Accessories</option>

                  </select>
            </div>


            <div class = "group">

                <label for="url" style  ='font-size:12px;' ><i class = "fa fa-user" style  = "padding-left:2px;"></i>&nbspImage File</label>
                <input type="file" id="url" class="form-control" style  = " margin-right:20px;" name = "url" required="">
                <span class="form-highlight"></span>
                <span class="form-bar"></span>
			    <span id="error_url" class="text-danger"></span>
            </div>
              <div class  ="group">
                                                      <label style="font-size:12px" for = 'role' class = "float-label" name = 'role'>Product Brand</label>

                <input type="text" id="brand" class="form-control"  name = "brand" required="">
                <span class="form-highlight"></span>
                <span class="form-bar"></span>
            <span id="error_brand" class="text-danger"></span>
            </div>

              <div class  ="group">
                                                      <label style="font-size:12px" for = 'role' class = "float-label" name = 'role'>Product Model</label>

                <input type="text" id="model" class="form-control"  name = "model" required="">
                <span class="form-highlight"></span>
                <span class="form-bar"></span>
            <span id="error_model" class="text-danger"></span>
            </div>

            <div class = "group">
                                                    <label style="font-size:12px" for = 'role' class = "float-label" name = 'role'>Product Descriptiony</label>

                <textarea rows="5" id="description" class="form-control" style = "border:1px solid rgba(117, 117, 117, 0.15);" name = "description" required=""></textarea>
                <span class="form-highlight"></span>
                <span class="form-bar"></span>
		        <span id="error_description" class="text-danger"></span>
            </div>

             <div class  ="group">
                                                     <label style="font-size:12px" for = 'role' class = "float-label" name = 'role'>Product Stock</label>

                 <input type="number" id="stock" class="form-control" name = "stock" min="1" required="">
                 <span class="form-highlight"></span>
                <span class="form-bar"></span>
                  <span id="error_stock" class="text-danger"></span>
            </div>



           <div class  ="group">
                                                   <label style="font-size:12px" for = 'role' class = "float-label" name = 'role'>Price($)</label>

                 <input type="text" pattern="\d*" id="price" class="form-control" name = "price" required="">
                 <span class="form-highlight"></span>
                <span class="form-bar"></span>
                  <span id="error_price" class="text-danger"></span>
            </div>
                        <input type  ="submit" id = "admSubmit" class = "btn btn-success" value  = "Add" onclick="return confirm('Are  you sure you want to add this new product')">

            </form>

      </div>
      <div class="modal-footer">

      </div>
    </div>
  </div>
</div>





<div id="updateModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
        <form id = "updateForm"  method = 'POST' action = '/update_inventory_product'  enctype="multipart/form-data">
      <div class="modal-header">
          <h4 class="modal-title">Update Product</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>

      </div>
      <div class="modal-body">


                    <input type="hidden" id='productID' class="form-control"  name = "updateID" required="" >

<!--              <div class  ="group">-->
<!--                <input type="text" id="updateName" class="form-control"  name = "updateName" required="">-->
<!--                <span class="form-highlight"></span>-->
<!--                <span class="form-bar"></span>-->
<!--                <label for="updateName" class="float-label" ><i class = "fa fa-user" style  = "padding-left:2px;"></i>Product Name</label>-->
<!--            <span id="error_updateName" class="text-danger"></span>-->
<!--            </div>-->

               <div class  ="group">
                                                       <label style="font-size:12px" for = 'role' class = "float-label" name = 'role'>Product Category</label>

                  <span class = 'form-highlight'></span>
                <span class = 'form-bar'></span>
                  <select class="form-control" id="updateName" name = 'updateName'>
                        <option value = "Keyboard">Keyboard</option>
                        <option value = "Graphic Cards">Graphic Cards</option>
                        <option value = "Mouse">Mouse</option>
                          <option value = "CPU">CPU</option>
                          <option value = "RAM">RAM</option>
                          <option value = "Audio Accessories">Audio Accessories</option>

                  </select>
            </div>





            <div class = "group">

                <label for="url" style = 'font-size:12px;'  >Image File</label>
                <input type="file" id="updateUrl" class="form-control" style  = " margin-right:20px;" name = "updateUrl" required="">
                <span class="form-highlight"></span>
                <span class="form-bar"></span>
			    <span id="error_updateUrl" class="text-danger"></span>
            </div>
              <div class  ="group">
                                                      <label style="font-size:12px" for = 'role' class = "float-label" name = 'role'>Product Brand</label>

                <input type="text" id="updateBrand" class="form-control"  name = "updateBrand" required="">
                <span class="form-highlight"></span>
                <span class="form-bar"></span>
            <span id="error_updateBrand" class="text-danger"></span>
            </div>

              <div class  ="group">
                                                      <label style="font-size:12px" for = 'role' class = "float-label" name = 'role'>Product Model</label>

                <input type="text" id="updateModel" class="form-control"  name = "updateModel" required="">
                <span class="form-highlight"></span>
                <span class="form-bar"></span>
            <span id="error_updateModel" class="text-danger"></span>
            </div>

            <div class = "group">
                                                    <label style="font-size:12px" for = 'role' class = "float-label" name = 'role'>Product Description</label>

                <textarea rows="5" id="updateDescription" class="form-control" style = "border:1px solid rgba(117, 117, 117, 0.15);" name = "updateDescription" required=""></textarea>
                <span class="form-highlight"></span>
                <span class="form-bar"></span>
		        <span id="error_updateDescription" class="text-danger"></span>
            </div>

             <div class  ="group">
                                                     <label style="font-size:12px" for = 'role' class = "float-label" name = 'role'>Product Stock</label>

                 <input type="number" id="updateStock" class="form-control" min ='0' name = "updateStock" required="">
                 <span class="form-highlight"></span>
                <span class="form-bar"></span>
                  <span id="error_updateStock" class="text-danger"></span>
            </div>



           <div class  ="group">
                                                   <label style="font-size:12px" for = 'role' class = "float-label" name = 'role'>Price($)</label>

                 <input type="text"  pattern="\d*" id="updatePrice" class="form-control" name = "updatePrice" required="">
                 <span class="form-highlight"></span>
                <span class="form-bar"></span>
                  <span id="error_updatePrice" class="text-danger"></span>
            </div>

      </div>

      <div class="modal-footer">
            <input type  ="submit" id = "update" class = "btn btn-info" value  = "Update"  onclick="return confirm('Are  you sure you want to update this existing product')">

      </div>

        </form>
    </div>


  </div>
</div>


<div class="container-fluid">

          <!-- Page Heading -->
          <h1 class="h3 mb-2 text-gray-800">User</h1>
          <p class="mb-4">DataTables is a third party plugin that is used to generate the demo table below. For more information about DataTables, please visit the <a target="_blank" href="https://datatables.net">official DataTables documentation</a>.</p>

          <!-- DataTales Example -->
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">User Accounts</h6>
            </div>
            <div class="card-body">
              <div class="table-responsive" style = "">
                  <button style = 'float:right; margin-left:100px;'class="btn btn-success" id = "addBtn" data-toggle="modal" data-target="#myModal">Create Product Listing</button>

              {#      {% if session['Role'] == 'SysAD' or session['Role'] == 'User Administrator' %} #}
<!--                            <button style = 'float:right; margin-left:100px;'class="btn btn-success" id = "addBtn" data-toggle="modal" data-target="#myModal">Create Product Listing</button>-->

               {#   {% else %} #}
<!--                            <button style = 'cursor:not-allowed;float:right; margin-left:100px;'class="btn btn-success"   data-toggle="modal" data-target="#myModal" disabled>Create Product Listing</button>-->
                 {#   {% endif %} #}
               <table class = "table table-bordered" id = "productDataTable" cellspacing="0" style  ="width:100%;">

                    <tr>
                    <thead>
                        <th>Product ID</th>
                        <th>Product Image</th>
                        <th>Product Name</th>
                        <th>Product Brand</th>
                        <th>Product Model</th>
                        <th>Product Description</th>
                        <th>Product Stock</th>
                        <th>Product Price($)</th>
                        <th>Actions</th>
                    </thead>
                        </tr>

                    <thead>
                    <tr>
                        <th>Product ID</th>
                        <th>Product Image</th>
                        <th>Product Name</th>
                        <th>Product Brand</th>
                        <th>Product Model</th>
                        <th>Product Description</th>
                        <th>Product Stock</th>
                        <th>Product Price($)</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                </table>
              </div>
            </div>
          </div>

        </div>
{% endblock %}
{% block script %}
<!-- Bootstrap core JavaScript-->
  <script src="../static/vendor/jquery/jquery.min.js"></script>
  <script src="../static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Core plugin JavaScript-->
  <script src="../static/vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Custom scripts for all pages-->
  <script src="../static/js/sb-admin-2.min.js"></script>

  <!-- Page level plugins -->
  <script src="../static/vendor/datatables/jquery.dataTables.min.js"></script>
  <script src="../static/vendor/datatables/dataTables.bootstrap4.min.js"></script>
    <script src = "../static/form.js"></script>
  <!-- Page level custom scripts -->
<script>



    function load(){
        $('#productDataTable').DataTable({
            'processing':true,
            'serverSide':false,
            'ajax':{url:"/retrieve_inventory_product"},
            'columns':[
                {data:"productID"},
                {data:"url"},
                {data:"name"},
                {data:"brand"},
                {data:"model"},
                {data:"description"},
                {data:"stock"},
                {data:"price"},
                {data:"Actions"}

            ]
        });
        }
        $(document).ready(function(){

        $('#updateForm').submit(function(e){
                        alert('Product Successfully updated in Our inventory');

        })


        $('#addForm').submit(function(e){
            alert('Product Successfully Added to Our inventory')
        });


           $(document).on('click','#deleteBtn',function(){
           var cfm;
           var stock = $(this).closest('tr').children('td:nth-child(7)').text();
           var id = $(this).closest('tr').children('td:first').text();

           var csrftoken = $('meta[name=csrf-token]').attr('content');

            $.ajaxSetup({
                beforeSend: function(xhr, settings) {
                    if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken)
                    }
                }
            })

            if(stock == '0')
            {
                  cfm = confirm("This product is out of stock. Please do double check if this item still supplied by your supplier. Are you sure you want to delete this record?");
            }else{
                  alert("Delete is not applicable for this item. This product still left " + stock + " in the stock.");
            }


             if(cfm)
             {
              var reason = prompt('Please State Your Reason For Deleting');
             if(reason)
           {
            $.ajax({
                data:{id:id},
                dataType:'json',
                type:'POST',
                url:'/delete_inventory_product',
                success:function(data){
                   alert("Succesfully deleted!")
                  var table = $('#productDataTable').DataTable();
                 table.clear().destroy();
                  load();
                },
                error:function(error){

                    alert(error);
                },
                });
                }else
                {
                    alert('Please key in  your reason!');
                }

                }
        });

        $(document).on('click','#updateBtn',function(){

            var productID =  $(this).closest('tr').children('td:first').text();
            var path = $(this).closest('tr').children('td:nth-child(2)').find('img').attr('src');
            var url = path.split(/[\\\/]/).pop();
            var name =  $(this).closest('tr').children('td:nth-child(3)').text();
            var brand =  $(this).closest('tr').children('td:nth-child(4)').text();
            var model =  $(this).closest('tr').children('td:nth-child(5)').text();
            var description =  $(this).closest('tr').children('td:nth-child(6)').text();
            var stock =  $(this).closest('tr').children('td:nth-child(7)').text();
            var price =  $(this).closest('tr').children('td:nth-child(8)').text();

            $('#productID').val(productID);
            $('#updateName').val(name);
            $('#updateBrand').val(brand);
            $('#updateModel').val(model);
            $('#updateDescription').val(description);
            $('#updateStock').val(stock);
            $('#updatePrice').val(price);

$("input type=[file]").val(url);


        });

      /*  $("#addForm").on('submit',function(e){
             $.ajax({
                data:{productName:$('#name').val(),imageURL:$("#url").val(),description:$('#description').val(),stock:$('#stock').val(),price:$('#price').val()},
                dataType:'json',
                type:'POST',
                url:'/add_inventory_product',
                success:function(data)
                {
                    console.log(data);
                },
                error:function(error)
                {
                    alert(error);
                },
                done:function(data)
                {
                    alert(data);
                }

             });

             e.preventDefault();
        });*/



            load();
            window.onload = function(){
                   $("#productDataTable tbody tr").each(function(i,el){
                   //var col2Text  =  $(this).find('td:eq(1)').text();
                    //var col2 =  $(this).find('td:eq(1)');
                    //col2.append("<img  class = 'imageProduct' width = '285px' height  = '177px'>");

                    //var newURL = '../static/images/' + col2Text
                    //console.log(newURL);
                    //console.log(col2Text);
                   // $(".imageProduct").attr('src',newURL);
                   // $('#imageURL').css('display','none');

            });
            };



        })


</script>


{% endblock %}
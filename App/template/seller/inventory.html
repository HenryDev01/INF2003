{% extends 'seller_base.html' %}
{#
{% block links %}
  <link href="../static/vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">
 <link href="../static/css/style.css" rel="stylesheet">
{% endblock %}
#}
{% block pageContent %}


<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <div class="modal-content">
      <div class="modal-header">
          <h4 class="modal-title">Add New Product</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>

      </div>
      <div class="modal-body">
        <form id="addForm" method="POST" action="/add_inventory_product" enctype="multipart/form-data">

          <div class="group">
            <label for="category" style="font-size:12px;">Product Category</label>
            <select class="form-control" id="category" name="category">
                {% for category in categories %}
                  <option value = "{{ category.product_category_translation }}">{{ category.product_category_translation }}</option>

                {% endfor %}
            </select>
          </div>

          <div class="group">
            <label for="brand" style="font-size:12px;">Name</label>
            <input type="text" id="name" class="form-control" name="name" required>
          </div>

          <div class="group">
            <label for="image" style="font-size:12px;">Upload Image</label>
            <input type="file" id="image" class="form-control" name="image" accept="image/*" required>
        </div>

          <div class="group">
            <label for="model" style="font-size:12px;">Model</label>
            <input type="text" id="model" class="form-control" name="model" required>
          </div>
        
          <div class="group">
            <label for="description" style="font-size:12px;">Description</label>
            <textarea rows="4" id="description" class="form-control" name="description" required></textarea>
          </div>
        
          <div class="form-row">
            <div class="form-group col-md-3">
              <label for="weight" style="font-size:12px;">Weight (kg)</label>
              <input type="number" step="0.01" min="0" id="weight" name="weight" class="form-control" required>
            </div>
            <div class="form-group col-md-3">
              <label for="length" style="font-size:12px;">Length (cm)</label>
              <input type="number" step="0.1" min="0" id="length" name="length" class="form-control" required>
            </div>
            <div class="form-group col-md-3">
              <label for="width" style="font-size:12px;">Width (cm)</label>
              <input type="number" step="0.1" min="0" id="width" name="width" class="form-control" required>
            </div>
            <div class="form-group col-md-3">
              <label for="height" style="font-size:12px;">Height (cm)</label>
              <input type="number" step="0.1" min="0" id="height" name="height" class="form-control" required>
            </div>
          </div>
        
          <div class="form-row">

            <div class="form-group col-md-6">
              <label for="price" style="font-size:12px;">Price ($)</label>
              <input type="number" step="0.01" min="0" id="price" name="price" class="form-control" required>
            </div>
            <div class="form-group col-md-6 d-flex align-items-center" style="padding-top: 30px; padding-left: 40px;">
              <div class="form-check ms-2">
                <input class="form-check-input" type="checkbox" id="stock" name="stock" value="1">
                <label class="form-check-label" for="stock" style="font-size:12px;">In Stock</label>
              </div>
            </div>
            
          </div>
        
          <input type="submit" class="btn btn-success" value="Add Product" onclick="return confirm('Are you sure you want to add this product?')">
        </form>
        

      </div>
      <div class="modal-footer">

      </div>
    </div>
  </div>
</div>

<div id="updateModal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="updateForm" method="POST" action="/update_inventory_product" enctype="multipart/form-data">
        <div class="modal-header">
          <h4 class="modal-title">Update Product</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
      
        <div class="modal-body">
          <input type="hidden" id="productID" name="productID" required>
      
             <div class="group">
            <label for="updateCategory" style="font-size:12px;">Product Category</label>
            <select class="form-control" id="updateCategory" name="updateCategory">
                {% for category in categories %}
                  <option value = "{{ category.product_category_translation }}">{{ category.product_category_translation }}</option>

                {% endfor %}
            </select>
          </div>
      
          <div class="group">
            <label for="updateName" style="font-size:12px;">Name</label>
            <input type="text" id="updateName" class="form-control" name="updateName" required>
          </div>

          <div class="group">
          <label for="updateUrl" style="font-size:12px;">Product Image</label>

          <!-- readonly field to show the filename -->
          <input type="hidden" id="currentFilename" name ="currentFileName" class="form-control mb-2" readonly>

          <!-- file input for uploading new file -->
          <input type="file" id="updateUrl" class="form-control" name="updateUrl">
        </div>
        
          <div class="group">
            <label for="updateModel" style="font-size:12px;">Model</label>
            <input type="text" id="updateModel" class="form-control" name="updateModel" required>
          </div>
        
          <div class="group">
            <label for="updateDescription" style="font-size:12px;">Description</label>
            <textarea rows="4" id="updateDescription" class="form-control" name="updateDescription" required></textarea>
          </div>
        
          <div class="form-row">
            <div class="form-group col-md-3">
              <label for="updateWeight" style="font-size:12px;">Weight (kg)</label>
              <input type="number" step="0.01" min="0" id="updateWeight" name="updateWeight" class="form-control" required>
            </div>
            <div class="form-group col-md-3">
              <label for="updateLength" style="font-size:12px;">Length (cm)</label>
              <input type="number" step="0.1" min="0" id="updateLength" name="updateLength" class="form-control" required>
            </div>
            <div class="form-group col-md-3">
              <label for="updateWidth" style="font-size:12px;">Width (cm)</label>
              <input type="number" step="0.1" min="0" id="updateWidth" name="updateWidth" class="form-control" required>
            </div>
            <div class="form-group col-md-3">
              <label for="updateHeight" style="font-size:12px;">Height (cm)</label>
              <input type="number" step="0.1" min="0" id="updateHeight" name="updateHeight" class="form-control" required>
            </div>
          </div>
        
          <div class="form-row">

            <div class="form-group col-md-6">
              <label for="updatePrice" style="font-size:12px;">Price ($)</label>
              <input type="number" step="0.01" min="0" id="updatePrice" name="updatePrice" class="form-control" required>
            </div>
            <div class="form-group col-md-6 d-flex align-items-center" style="padding-top: 30px; padding-left: 40px;">
              <div class="form-check ms-2">
                <input class="form-check-input" type="checkbox" id="updateStock" name="updateStock" value="1">
                <label class="form-check-label" for="stock" style="font-size:12px;">In Stock</label>
              </div>
            </div>
          </div>
        </div>
      
        <div class="modal-footer">
          <input type="submit" class="btn btn-info" value="Update Product" onclick="return confirm('Are you sure you want to update this product?')">
        </div>
      </form>
       
    </div>
  </div>
</div>





<div class="container-fluid">
  <a href="/export_inventory_product" class="btn btn-primary" style="margin-bottom: 10px;">
  Export Products to Excel
</a>

          <!-- DataTales Example -->
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">Products</h6>
            </div>
            <div class="card-body">
              <div class="table-responsive" style = "">
                  <button style = 'float:right; margin-left:100px;'class="btn btn-success" id = "addBtn" data-toggle="modal" data-target="#myModal">Create Product Listing</button>


               <table class = "table table-bordered" id = "productDataTable" cellspacing="0" style  ="width:100%;">

                    <tr>
                    <thead>
                        <th>ID</th>
                        <th>Image</th>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Model</th>
                        <th>Description</th>
                        <th>In Stock</th>
                        <th>Price($)</th>
                        <th>Weight(g)</th>
                        <th>Length(cm)</th>
                        <th>Width(cm)</th>
                        <th>Height(cm)</th>
                        <th>Actions</th>
                    </thead>
                        </tr>

                    <thead>
                    <tr>
                      <th>ID</th>
                      <th>Image</th>
                      <th>Name</th>
                      <th>Category</th>
                      <th>Model</th>
                      <th>Description</th>
                      <th>In Stock</th>
                      <th>Price($)</th>
                      <th>Weight(g)</th>
                      <th>Length(cm)</th>
                      <th>Width(cm)</th>
                      <th>Height(cm)</th>
                      <th>Actions</th>
                    </tr>
                    </thead>
                </table>
              </div>
            </div>
          </div>

        </div>
{% endblock %}
{% block script %}
<!-- Bootstrap core JavaScript-->
<!--  <script src="../static/vendor/jquery/jquery.min.js"></script>-->
<!--  <script src="../static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>-->

<!--  &lt;!&ndash; Core plugin JavaScript&ndash;&gt;-->
<!--  <script src="../static/vendor/jquery-easing/jquery.easing.min.js"></script>-->

<!--  &lt;!&ndash; Custom scripts for all pages&ndash;&gt;-->
<!--  <script src="../static/js/sb-admin-2.min.js"></script>-->

  <!-- Page level plugins -->
  <script src="../static/vendor/datatables/jquery.dataTables.min.js"></script>
  <script src="../static/vendor/datatables/dataTables.bootstrap4.min.js"></script>
    <script src = "../static/form.js"></script>
  <!-- Page level custom scripts -->
<script>



    function load(){
        $('#productDataTable').DataTable({
            'processing':true,
            'serverSide':false,
            'ajax':{url:"/retrieve_inventory_product"},
            'columns':[
                {data:"product_id"},
                {data:"product_photo"},
                {data:"product_name"},
                {data:"product_category_translation"},
                {data:"product_model"},
                {data:"product_description"},
                {data:"has_stock"},
                {data:"price"},
                {data:"product_weight_g"},
                {data:"product_length_cm"},
                {data:"product_width_cm"},
                {data:"product_height_cm"},
                {data:"Actions"}

            ]
        });
        }
        $(document).ready(function(){

        $('#updateForm').submit(function(e){
                        alert('Product Successfully updated in Our inventory');

        })


        $('#addForm').submit(function(e){
            alert('Product Successfully Added to Our inventory')
        });


           $(document).on('click','#deleteBtn',function(){
           var cfm;
           var stock = $(this).closest('tr').children('td:nth-child(7)').text();
           var productid = $(this).closest('tr').children('td:first').text();
          console.log(productid);
           var csrftoken = $('meta[name=csrf-token]').attr('content');

            $.ajaxSetup({
                beforeSend: function(xhr, settings) {
                    if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken)
                    }
                }
            })





              var reason = prompt('Please State Your Reason For Deleting');
                 if(reason)
               {
                $.ajax({
                    data:{ id: productid },
                    dataType:'json',
                    type:'POST',
                    url:'/delete_inventory_product',
                    success:function(data){
                       alert("Succesfully deleted!")
                      var table = $('#productDataTable').DataTable();
                     table.clear().destroy();
                      load();
                    },
                    error:function(error){

                        alert(error);
                    },
                    });
                    }else
                {
                    alert('Please key in  your reason!');
                }


        });

        $(document).on('click','#updateBtn',function(){

          var $tr = $(this).closest('tr');
    
          var productID = $tr.find('td:eq(0)').text().trim();
          var url = $tr.find('td:eq(1) img').attr('src') || '';
          var name = $tr.find('td:eq(2)').text().trim();
          var category = $tr.find('td:eq(3)').text().trim();
          var model = $tr.find('td:eq(4)').text().trim();
          var description = $tr.find('td:eq(5)').text().trim();
          var stock = $tr.find('td:eq(6)').text().trim();
          var price = $tr.find('td:eq(7)').text().trim();
          var weight = $tr.find('td:eq(8)').text().trim();
          var length = $tr.find('td:eq(9)').text().trim();
          var width = $tr.find('td:eq(10)').text().trim();
          var height = $tr.find('td:eq(11)').text().trim();
          if (stock == 1){
            $('#updateStock').prop('checked', true);
          }
          else if (stock == 0) {
            $('#updateStock').prop('checked', false);
 
          }
          var url = $tr.find('td:eq(1) img').attr('src') || '';

          var fileName = url.split('/').pop();
          $('#productID').val(productID);
          $('#currentFileName').val(fileName);
          $('#updateName').val(name);
          $('#updateCategory').val(category);
          $('#updateModel').val(model);
          $('#updateDescription').val(description);
          $('#updatePrice').val(price);
          $('#updateWeight').val(weight);
          $('#updateLength').val(length);
          $('#updateWidth').val(width);
          $('#updateHeight').val(height);

        });




            load();




        })


</script>


{% endblock %}